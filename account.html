<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account - Cronoshop</title>
    <meta name="description" content="Gestisci il tuo account Cronoshop, visualizza le tue statistiche e personalizza le tue preferenze.">
    <link rel="icon" type="image/png" href="assets/cronoshop-logo.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation -->
    <div id="navigation"></div>

    <!-- Page Header -->
    <section class="hero-section" style="min-height: 40vh;">
        <div class="hero-content">
            <h1 class="hero-title">üë§ Il Tuo Account</h1>
            <p class="hero-subtitle">Gestisci le tue preferenze e visualizza le tue statistiche</p>
        </div>
    </section>

    <!-- Account Content -->
    <section class="container" style="margin-top: -50px; position: relative; z-index: 10;">
        <div class="row">
            <!-- Profile Card -->
            <div class="col-sm-4">
                <div class="card text-center">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">üë§</div>
                    <h3 id="userName">Utente Cronoshop</h3>
                    <p class="text-secondary" id="userEmail">Non connesso</p>
                    <button class="btn btn-primary btn-block" id="loginBtn">Accedi</button>
                </div>
                
                <!-- Quick Stats -->
                <div class="card mt-4">
                    <h5 class="mb-3">üìä Le Tue Statistiche</h5>
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <h4 class="text-primary" id="wishlistCount">0</h4>
                            <small>Wishlist</small>
                        </div>
                        <div class="col-6 mb-3">
                            <h4 class="text-primary" id="cartCount">0</h4>
                            <small>Carrello</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-primary" id="visitCount">1</h4>
                            <small>Visite</small>
                        </div>
                        <div class="col-6">
                            <h4 class="text-primary" id="favoriteCategory">Tech</h4>
                            <small>Categoria Preferita</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings -->
            <div class="col-sm-8">
                <div class="card">
                    <h4 class="mb-4">‚öôÔ∏è Impostazioni</h4>
                    
                    <!-- Theme Settings -->
                    <div class="form-group">
                        <label class="form-label">üé® Tema</label>
                        <div class="row">
                            <div class="col-6">
                                <button class="btn btn-secondary btn-block theme-option" data-theme="light">‚òÄÔ∏è Chiaro</button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-secondary btn-block theme-option" data-theme="dark">üåô Scuro</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="form-group">
                        <label class="form-label">üîî Notifiche</label>
                        <div class="row">
                            <div class="col-sm-6">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="emailNotifications"> Email
                                </label>
                            </div>
                            <div class="col-sm-6">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="pushNotifications"> Push
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Categories -->
                    <div class="form-group">
                        <label class="form-label">üìÇ Categorie Preferite</label>
                        <div class="row">
                            <div class="col-sm-4">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="category-pref" value="smartphone"> üì± Smartphone
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="category-pref" value="tech"> üíª Tech
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="category-pref" value="fashion"> üëï Fashion
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="category-pref" value="casa"> üè† Casa
                                </label>
                            </div>
                            <div class="col-sm-4">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" class="category-pref" value="salute"> üíä Salute
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" id="saveSettingsBtn">üíæ Salva Impostazioni</button>
                </div>
                
                <!-- Quick Actions -->
                <div class="card mt-4">
                    <h5 class="mb-3">üöÄ Azioni Rapide</h5>
                    <div class="row">
                        <div class="col-sm-6 mb-3">
                            <a href="wishlist.html" class="btn btn-secondary btn-block">‚ù§Ô∏è Vai alla Wishlist</a>
                        </div>
                        <div class="col-sm-6 mb-3">
                            <a href="cart.html" class="btn btn-secondary btn-block">üõí Vai al Carrello</a>
                        </div>
                        <div class="col-sm-6 mb-3">
                            <a href="groups.html" class="btn btn-secondary btn-block">üí¨ Unisciti ai Gruppi</a>
                        </div>
                        <div class="col-sm-6 mb-3">
                            <a href="cronoai.html" class="btn btn-secondary btn-block">ü§ñ Prova CronoAI</a>
                        </div>
                    </div>
                </div>
                
                <!-- Data Management -->
                <div class="card mt-4">
                    <h5 class="mb-3">üóÇÔ∏è Gestione Dati</h5>
                    <div class="row">
                        <div class="col-sm-6 mb-3">
                            <button class="btn btn-warning btn-block" id="exportDataBtn">üì§ Esporta Dati</button>
                        </div>
                        <div class="col-sm-6 mb-3">
                            <button class="btn btn-danger btn-block" id="clearDataBtn">üóëÔ∏è Cancella Dati</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Cronoshop</h4>
                    <p>La tua piattaforma per le migliori offerte Amazon.</p>
                </div>
                <div class="footer-section">
                    <h4>Account</h4>
                    <a href="wishlist.html">Wishlist</a>
                    <a href="cart.html">Carrello</a>
                    <a href="stats.html">Statistiche</a>
                </div>
                <div class="footer-section">
                    <h4>Supporto</h4>
                    <a href="faq.html">FAQ</a>
                    <a href="privacy.html">Privacy</a>
                    <a href="terms.html">Termini</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Cronoshop. Tutti i diritti riservati.</p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        class AccountManager {
            constructor() {
                this.userData = {};
                this.init();
            }

            init() {
                this.loadNavigation();
                this.loadUserData();
                this.updateStats();
                this.loadSettings();
                this.setupEventListeners();
            }

            loadNavigation() {
                fetch('nav.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('navigation').innerHTML = data;
                    })
                    .catch(error => console.error('Error loading navigation:', error));
            }

            loadUserData() {
                try {
                    const savedData = localStorage.getItem('cronoshop_data');
                    this.userData = savedData ? JSON.parse(savedData) : {};
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            }

            saveUserData() {
                try {
                    localStorage.setItem('cronoshop_data', JSON.stringify(this.userData));
                } catch (error) {
                    console.error('Error saving user data:', error);
                }
            }

            updateStats() {
                const wishlist = this.userData.wishlist || [];
                const cart = this.userData.cart || [];
                const visitData = JSON.parse(localStorage.getItem('visitData') || '{}');

                document.getElementById('wishlistCount').textContent = wishlist.length;
                document.getElementById('cartCount').textContent = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
                document.getElementById('visitCount').textContent = visitData.totalVisits || 1;

                // Calculate favorite category
                const categories = {};
                [...wishlist, ...cart].forEach(item => {
                    categories[item.categoria] = (categories[item.categoria] || 0) + 1;
                });
                
                const favoriteCategory = Object.keys(categories).reduce((a, b) => 
                    categories[a] > categories[b] ? a : b, 'tech'
                );
                
                document.getElementById('favoriteCategory').textContent = this.getCategoryName(favoriteCategory);
            }

            loadSettings() {
                const settings = this.userData.settings || {};
                
                // Theme
                const currentTheme = localStorage.getItem('theme') || 'light';
                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                    if (btn.dataset.theme === currentTheme) {
                        btn.classList.remove('btn-secondary');
                        btn.classList.add('btn-primary');
                    }
                });

                // Notifications
                document.getElementById('emailNotifications').checked = settings.emailNotifications || false;
                document.getElementById('pushNotifications').checked = settings.pushNotifications || false;

                // Categories
                const preferredCategories = settings.preferredCategories || [];
                document.querySelectorAll('.category-pref').forEach(checkbox => {
                    checkbox.checked = preferredCategories.includes(checkbox.value);
                });
            }

            saveSettings() {
                const settings = {
                    emailNotifications: document.getElementById('emailNotifications').checked,
                    pushNotifications: document.getElementById('pushNotifications').checked,
                    preferredCategories: Array.from(document.querySelectorAll('.category-pref:checked')).map(cb => cb.value)
                };

                this.userData.settings = settings;
                this.saveUserData();
                this.showNotification('Impostazioni salvate!', 'success');
            }

            exportData() {
                const dataToExport = {
                    wishlist: this.userData.wishlist || [],
                    cart: this.userData.cart || [],
                    settings: this.userData.settings || {},
                    exportDate: new Date().toISOString()
                };

                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'cronoshop-data.json';
                link.click();
                
                URL.revokeObjectURL(url);
                this.showNotification('Dati esportati!', 'success');
            }

            clearData() {
                if (confirm('Sei sicuro di voler cancellare tutti i tuoi dati? Questa azione non pu√≤ essere annullata.')) {
                    localStorage.removeItem('cronoshop_data');
                    localStorage.removeItem('visitData');
                    this.userData = {};
                    this.updateStats();
                    this.loadSettings();
                    this.showNotification('Dati cancellati!', 'success');
                }
            }

            setupEventListeners() {
                // Theme buttons
                document.querySelectorAll('.theme-option').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const theme = e.target.dataset.theme;
                        localStorage.setItem('theme', theme);
                        
                        // Update UI
                        document.querySelectorAll('.theme-option').forEach(b => {
                            b.classList.remove('btn-primary');
                            b.classList.add('btn-secondary');
                        });
                        e.target.classList.remove('btn-secondary');
                        e.target.classList.add('btn-primary');
                        
                        // Apply theme
                        if (window.navigationManager) {
                            window.navigationManager.currentTheme = theme;
                            window.navigationManager.applyTheme();
                        }
                        
                        this.showNotification(`Tema ${theme === 'dark' ? 'scuro' : 'chiaro'} applicato!`, 'success');
                    });
                });

                // Save settings
                document.getElementById('saveSettingsBtn').addEventListener('click', () => {
                    this.saveSettings();
                });

                // Export data
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportData();
                });

                // Clear data
                document.getElementById('clearDataBtn').addEventListener('click', () => {
                    this.clearData();
                });

                // Login button (placeholder)
                document.getElementById('loginBtn').addEventListener('click', () => {
                    this.showNotification('Funzione di login in arrivo!', 'info');
                });
            }

            getCategoryName(category) {
                const categoryNames = {
                    smartphone: 'Smartphone',
                    tech: 'Tech',
                    fashion: 'Fashion',
                    casa: 'Casa',
                    salute: 'Salute'
                };
                return categoryNames[category] || category;
            }

            showNotification(message, type = 'info') {
                if (window.showNotification) {
                    window.showNotification(message, type);
                } else {
                    console.log(`${type.toUpperCase()}: ${message}`);
                }
            }
        }

        // Initialize account manager
        document.addEventListener('DOMContentLoaded', () => {
            new AccountManager();
        });
    </script>
</body>
</html>